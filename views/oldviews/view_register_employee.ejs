<% include layout/header %> <% include layout/navigation %>

<div class="m-content">
  <div class="m-portlet m-portlet--mobile">
    <div class="m-portlet__head">
      <div class="m-portlet__head-caption">
        <div class="m-portlet__head-title">
          <h3 class="m-portlet__head-text">Register Employee</h3>
        </div>
      </div>
    </div>
    <div class="m-portlet__body">
      <form
        id="fregister"
        class="m-form m-form--fit m-form--label-align-right"
        action="/process-register"
        method="POST"
      >
        <input
          type="text"
          class="form-control"
          id="_method"
          hidden
          name="_method"
          value="POST"
        />
        <div class="modal-body">
          <div class="form-group m-form__group row">
            <div class="col-lg-12">
              <label>Username</label>
              <input
                id="username"
                type="text"
                class="form-control m-input"
                placeholder="Username"
                name="username"
                autofocus
              />
            </div>
          </div>
          <div class="form-group m-form__group row">
            <div class="col-lg-12">
              <label>Email</label>
              <input
                id="email"
                type="text"
                class="form-control m-input"
                placeholder="Email"
                name="email"
              />
            </div>
          </div>
          <div class="form-group m-form__group row">
            <div class="col-lg-12">
              <label>Password</label>
              <input
                id="password"
                type="text"
                class="form-control m-input"
                placeholder="Password"
                name="password"
              />
            </div>
          </div>        
          <div class="form-group m-form__group row">
            <div class="col-lg-12">
              <label>Roles</label>
              <select id="id_roles" class="form-control m-input" placeholder="Roles" name="id_roles">
                <%if(roles.data.success){%>
                  <%roles.data.data.forEach(
                    (rows) => { %>
                        <option value="<%=rows.id%>"><%=rows.name%></option>
                    <% }
                  )%>
                <%}%>
              </select>
            </div>
          </div>        
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn m-btn m-btn--gradient-from-focus m-btn--gradient-to-danger"
            id="buttonadd"
          >
            Register
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<% include layout/footer %> <% include layout/script %>

<script type="text/javascript">
  var typingTimer;
  var doneTypingInterval = 200;
  var $inputUsername = $("#username");
  var $inputEmail = $("#email");
  var $inputPassword = $("#password");
  var $buttonAdd = $("#buttonadd");
  //on keyup, start the countdown
  $inputUsername.on("change", function () {
    clearTimeout(typingTimer);
    if ($inputUsername.value != "") {
      typingTimer = setTimeout(doneTypingUsername, doneTypingInterval);
    }
  });

  $inputEmail.on("change", function () {
    clearTimeout(typingTimer);
    if ($inputEmail.value != "") {
      typingTimer = setTimeout(doneTypingEmail, doneTypingInterval);
    }
  });

  $inputPassword.on("change", function () {
    clearTimeout(typingTimer);
    if ($inputPassword.value != "") {
      typingTimer = setTimeout(doneTypingPassword, doneTypingInterval);
    }
  });

  function doneTypingUsername() {
    $inputEmail.focus();
  }

  function doneTypingEmail() {
    $inputPassword.focus();
  }

  function doneTypingPassword() {
    // $("#buttonadd").click();
  }

  $("#buttonadd").click(function () {
    var form = $("#fregister");
    $.ajax({
      url: $("#fregister").attr("action"),
      data: $("#fregister").serialize(),
      method: $("#_method").val(),
      success: function (res) {
        Clear();
        if (res) {
          if (res.success == true) {
            swal({
              position: "center",
              type: "success",
              title: res.message,
              showConfirmButton: !1,
              timer: 1500,
            });
          } else {
            swal({
              position: "center",
              type: "error",
              title: res.message,
              showConfirmButton: !1,
              timer: 1500,
            });
          }
        } else {
          swal({
            position: "center",
            type: "error",
            title: "Server Error, Contact webmaster!",
            showConfirmButton: !1,
            timer: 1500,
          });
        }
      },
    });
  });
  function Clear() {
    $inputUsername.val("");
    $inputEmail.val("");
    $inputPassword.val("");
    $inputUsername.focus();
  }
</script>
